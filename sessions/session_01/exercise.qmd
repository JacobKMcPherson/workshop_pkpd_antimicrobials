---
title: "Exercise"
format: html
editor: visual
execute:
  shiny: true
  shinylive: true
---

This interactive module demonstrates multiple dosing pharmacokinetics using patient-specific parameters.

::: {.main-layout}

::: {.controls-middle}

## Controls

::: {.controls-grid}

::: {.controls-column-1}
### Random Patient Generator
::: {.patient-generator}
<div style="margin-bottom: 20px;">
<button id="generate-patient-btn" onclick="generateRandomPatient()">Generate Random Patient</button>
<div id="patient-info" style="margin-top: 15px;">
<ul style="list-style-type: none; padding-left: 0;">
<li><strong>Age:</strong> <u><span id="patient-age">-</span></u> years</li>
<li><strong>Sex:</strong> <u><span id="patient-sex">-</span></u></li>
<li><strong>Height:</strong> <u><span id="patient-height">-</span></u> cm</li>
<li><strong>Weight:</strong> <u><span id="patient-weight">-</span></u> kg</li>
<li><strong>Creatinine:</strong> <u><span id="patient-creatinine">-</span></u> mg/dL</li>
</ul>
</div>
<div class="small-buttons" style="margin-top: 15px;">
<button id="reset-btn" onclick="resetSimulation()" class="small-btn">Reset Parameters</button>
<button id="random-btn" onclick="randomizeParameters()" class="small-btn">Random Simulation</button>
</div>
</div>
:::

### Drug Name
::: {.drug-name-section}
<div style="margin-bottom: 20px;">
<label for="drug-name-input" style="font-weight: bold; color: #495057; display: block; margin-bottom: 5px;">Drug Name:</label>
<input type="text" id="drug-name-input" placeholder="Enter drug name (e.g., Vancomycin)" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; background-color: white;">
</div>
:::
:::

::: {.controls-column-2}
### Core PK Parameters
::: {.pk-properties-compact}
::: {.control-group-compact}
<label for="bioavailability-slider">Bioavailability (F):</label>
<input type="range" id="bioavailability-slider" min="0.1" max="1.0" value="0.8" step="0.05">
<span id="bioavailability-value">0.8</span>
:::

::: {.control-group-compact}
<label for="fraction-unbound-slider">Fraction Unbound:</label>
<input type="range" id="fraction-unbound-slider" min="0.0" max="1.0" value="0.1" step="0.01">
<span id="fraction-unbound-value">0.1</span>
:::

::: {.control-group-compact}
<label for="volume-slider">Volume of Distribution (L/kg):</label>
<input type="range" id="volume-slider" min="0.1" max="10" value="0.7" step="0.1">
<span id="volume-value">0.7</span> L/kg
:::

::: {.control-group-compact}
<label for="f-renal-slider">Fraction Renally Cleared:</label>
<input type="range" id="f-renal-slider" min="0.0" max="1.0" value="0.8" step="0.05">
<span id="f-renal-value">0.8</span>
:::
:::
:::

::: {.controls-column-3}
### Dosing Parameters
::: {.pk-properties-compact}
::: {.control-group-compact}
<label for="loading-dose-slider">Loading Dose (mg):</label>
<input type="range" id="loading-dose-slider" min="0" max="3000" value="250" step="50">
<span id="loading-dose-value">0</span> mg
:::

::: {.control-group-compact}
<label for="dose-slider">Dose (mg):</label>
<input type="range" id="dose-slider" min="0" max="3000" value="250" step="50">
<span id="dose-value">250</span> mg
:::

::: {.control-group-compact}
<label for="interval-slider">Dosing Interval (hrs):</label>
<input type="range" id="interval-slider" min="1" max="48" value="24" step="1">
<span id="interval-value">24</span> hrs
:::

::: {.control-group-compact}
<label for="duration-slider">Treatment Duration (days):</label>
<input type="range" id="duration-slider" min="1" max="14" value="10" step="1">
<span id="duration-value">10</span> days
:::

::: {.control-group-compact}
<label for="formulation-select">Formulation:</label>
<select id="formulation-select" style="width: 100%; padding: 5px; border: 1px solid #ced4da; border-radius: 4px; background-color: white;">
<option value="slow">Slow (Extended Release)</option>
<option value="medium" selected>Medium (Standard Oral)</option>
<option value="fast">Fast (IV Bolus)</option>
</select>
<span id="formulation-value">Medium (Standard Oral)</span>
:::
:::
:::

:::

:::

::: {.plot-data-right}
## Plot and Subject Data

::: {.panel-tabset}

### Plot

::: {#concentration-plot style="width: 100%; height: 500px;"}
<div id="chart-fallback">
  <p>Loading interactive chart...</p>
  <canvas id="pk-chart" width="800" height="400"></canvas>
</div>
:::

::: {.simulation-buttons}
<button id="scale-toggle-btn" onclick="toggleScale()">Switch to Linear</button>
<button id="download-btn" onclick="downloadData()">Download Data</button>
:::

### Reference Lines
::: {.reference-properties}
::: {.control-group}
<label for="toxicity-slider">Toxicity Threshold (mg/L):</label>
<input type="range" id="toxicity-slider" min="0" max="100" value="20" step="1">
<span id="toxicity-value">20</span> mg/L
:::

::: {.control-group}
<label for="efficacy-slider">Efficacy Threshold (mg/L):</label>
<input type="range" id="efficacy-slider" min="0" max="100" value="5" step="0.5">
<span id="efficacy-value">5</span> mg/L
:::
:::

### Subject Data

::: {#subject-table}
<table id="pk-table" class="table table-striped">
<thead>
<tr>
<th>Subject</th>
<th>Drug Name</th>
<th>Age</th>
<th>Sex</th>
<th>Ht (cm)</th>
<th>Wt (kg)</th>
<th>BMI</th>
<th>IBW (kg)</th>
<th>Adj IBW (kg)</th>
<th>Creatinine (mg/dL)</th>
<th>CrCl (mL/min)</th>
<th>Loading Dose (mg)</th>
<th>Dose (mg)</th>
<th>Interval (hrs)</th>
<th>Duration (days)</th>
<th>Clearance (L/h)</th>
<th>Volume (L)</th>
<th>Fraction Unbound</th>
<th>V<sub>ss,u</sub> (L)</th>
<th>Bioavailability</th>
<th>Half-life (h)</th>
<th>C<sub>ss,avg</sub></th>
<th>AUC<sub>0-24h</sub></th>
<th>C<sub>max</sub></th>
<th>AUC/Efficacy</th>
<th>C<sub>max</sub>/Efficacy</th>
<th>Time>Efficacy (%)</th>
</tr>
</thead>
<tbody id="pk-table-body">
</tbody>
</table>
:::

:::

:::

:::

## Educational Content

### Key Pharmacokinetic Concepts

**Bioavailability (F)**: The fraction of an administered dose that reaches the systemic circulation unchanged. For oral tablets, this is typically less than 1.0 due to first-pass metabolism and incomplete absorption.

**Clearance (CL)**: The volume of plasma from which a drug is completely removed per unit time. It determines the maintenance dose required to achieve steady-state concentrations.

**Volume of Distribution (Vd)**: The drug-specific volume of distribution per kilogram of body weight. This represents how extensively the drug distributes into body tissues relative to plasma. The total volume of distribution is calculated by multiplying this value by the patient's weight.

**Creatinine Clearance**: Calculated using the Cockcroft-Gault equation to estimate kidney function, which directly influences drug clearance for renally eliminated drugs.

**Half-life (t½)**: The time required for the plasma concentration to decrease by 50%. It's calculated as: t½ = 0.693 × Vd/CL

**Multiple Dosing**: With repeated dosing at variable intervals (8-48 hours), steady-state is approached after approximately 5 half-lives. The degree of accumulation depends on the dosing interval relative to the half-life. Shorter intervals lead to higher steady-state concentrations but also greater accumulation.

### Blood Sampling Strategy

In this simulation, blood samples are collected every 1 hour to provide a detailed view of how pharmacokinetic data is collected in clinical practice. This sampling frequency allows us to:

- Capture both peak and trough concentrations
- Observe the full absorption and elimination phases
- Reduce the burden on patients compared to more frequent sampling
- Provide sufficient data points for pharmacokinetic analysis

### Simplified Pharmacokinetic Model

This simulation uses a simplified one-compartment model with first-order absorption that focuses on the minimum essential parameters needed to generate a multiple dosing pharmacokinetic plot:

**Essential PK Parameters:**
- **Clearance (CL)**: Automatically calculated from patient's creatinine clearance using Cockcroft-Gault equation
- **Volume of Distribution (Vd)**: Drug-specific volume per kg multiplied by patient weight
- **Bioavailability (F)**: Fraction of dose reaching systemic circulation

**Patient-Specific Factors:**
- **Creatinine Clearance**: Calculated using Cockcroft-Gault: CrCl = [(140 - age) × weight × (0.85 if female)] / (72 × serum creatinine)
- **Weight-Based Dosing**: Volume of distribution scales directly with patient weight

**Dosing Parameters:**
- **Dose**: Amount of drug administered per dose
- **Dosing Interval**: Time between doses
- **Treatment Duration**: Total length of treatment

This approach incorporates key patient-specific factors (age, sex, weight, creatinine) while maintaining the core functionality needed to understand multiple dosing pharmacokinetics and the clinical application of the Cockcroft-Gault equation.

### Knowledge Check Quiz

Test your understanding by calculating the following parameters for the current patient:

::: {.quiz-section}
::: {.quiz-question}
**1. Creatinine Clearance (mL/min):**
<input type="number" id="quiz-crcl" placeholder="Enter your calculation" step="0.1" style="width: 100%; padding: 5px; margin: 5px 0; border: 1px solid #ced4da; border-radius: 4px;">
<span id="quiz-crcl-feedback" class="quiz-feedback"></span>
:::

::: {.quiz-question}
**2. Adjusted Body Weight (kg):**
<input type="number" id="quiz-adjbw" placeholder="Enter your calculation" step="0.1" style="width: 100%; padding: 5px; margin: 5px 0; border: 1px solid #ced4da; border-radius: 4px;">
<span id="quiz-adjbw-feedback" class="quiz-feedback"></span>
:::

::: {.quiz-question}
**3. Volume of Distribution of Unbound Drug (L):**
<input type="number" id="quiz-vss" placeholder="Enter your calculation" step="0.1" style="width: 100%; padding: 5px; margin: 5px 0; border: 1px solid #ced4da; border-radius: 4px;">
<span id="quiz-vss-feedback" class="quiz-feedback"></span>
:::

::: {.quiz-question}
**4. Time to Steady State - tss (hours):**
<input type="number" id="quiz-tss" placeholder="Enter your calculation" step="0.1" style="width: 100%; padding: 5px; margin: 5px 0; border: 1px solid #ced4da; border-radius: 4px;">
<span id="quiz-tss-feedback" class="quiz-feedback"></span>
:::

::: {.quiz-question}
**5. Average Steady-State Concentration - Css,avg (mg/L):**
<input type="number" id="quiz-cssavg" placeholder="Enter your calculation" step="0.01" style="width: 100%; padding: 5px; margin: 5px 0; border: 1px solid #ced4da; border-radius: 4px;">
<span id="quiz-cssavg-feedback" class="quiz-feedback"></span>
:::

<div style="text-align: center; margin: 15px 0;">
<button id="check-answers-btn" onclick="checkQuizAnswers()" style="background-color: #28a745; color: white; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer; font-size: 14px;">Check Answers</button>
<button id="reset-quiz-btn" onclick="resetQuiz()" style="background-color: #6c757d; color: white; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer; font-size: 14px; margin-left: 10px;">Reset Quiz</button>
</div>

:::

::::: {.d-flex .justify-content-between .border-top .pt-4 .mt-4}
<div>

[← Session 1](index.qmd){.btn .btn-outline-primary}

</div>

<div>

[Session 2 →](../session_02/index.qmd){.btn .btn-outline-primary}

</div>
:::::

<style>
/* Main layout - now two columns */
.main-layout {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 20px;
  margin: 20px 0;
  min-height: 100vh;
}

/* Remove sidebar-left styles -- deprecated */

/* Controls middle - now first column */
.controls-middle {
  background-color: #ffffff;
  padding: 20px;
  border-radius: 8px;
  height: fit-content;
}

/* Controls grid */
.controls-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 20px;
  margin-top: 20px;
}

.controls-column-1,
.controls-column-2,
.controls-column-3 {
  background-color: #ffffff;
  padding: 15px;
  border-radius: 8px;
  border: 1px solid #dee2e6;
}

/* Educational content, plot-data-right - now second column */
.plot-data-right {
  background-color: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  border: 1px solid #dee2e6;
}

/* Responsive layout for small screens */
@media (max-width: 1200px) {
  .main-layout {
    grid-template-columns: 1fr;
    gap: 20px;
  }
  .controls-grid {
    grid-template-columns: 1fr;
    gap: 15px;
  }
}

.patient-generator {
  background-color: #fff;
  border: 2px solid #28a745;
  border-radius: 8px;
  padding: 20px;
}

.patient-generator button {
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 5px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.patient-generator button:hover {
  background-color: #218838;
}

.small-buttons {
  display: flex;
  flex-direction: column; /* Change direction to column to stack buttons */
  gap: 5px; /* Adjust the gap between buttons */
  justify-content: flex-start; /* Align buttons to the start */
}

.small-btn {
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 6px 12px;
  font-size: 12px;
  cursor: pointer;
  transition: background-color 0.3s;
  flex: 1;
}

.small-btn:hover {
  background-color: #0056b3;
}

#reset-btn.small-btn {
  background-color: #6c757d;
}

#reset-btn.small-btn:hover {
  background-color: #545b62;
}

#random-btn.small-btn {
  background-color: #17a2b8;
}

#random-btn.small-btn:hover {
  background-color: #138496;
}

#patient-info ul {
  margin-top: 15px;
}

#patient-info li {
  margin: 5px 0;
  font-size: 14px;
}

.pk-properties-compact {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.control-group-compact {
  display: flex;
  flex-direction: column;
  gap: 3px;
  padding: 8px;
  background-color: #fff;
  border-radius: 4px;
  border: 1px solid #dee2e6;
}

.control-group-compact label {
  font-weight: bold;
  color: #495057;
  font-size: 0.9em;
  margin-bottom: 2px;
}

.control-group-compact input[type="range"] {
  width: 100%;
  margin: 2px 0;
}

.control-group-compact span {
  font-size: 0.9em;
  color: #6c757d;
  text-align: center;
}

.control-group select {
  width: 100%;
  padding: 5px;
  border: 1px solid #ced4da;
  border-radius: 4px;
  background-color: white;
}

.control-group {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.control-group label {
  font-weight: bold;
  color: #495057;
}

.control-group input[type="range"] {
  width: 100%;
}

.reference-properties {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.simulation-buttons {
  text-align: center;
  margin: 20px 0;
}

.simulation-buttons button {
  margin: 0 10px;
  padding: 10px 20px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}

.simulation-buttons button:hover {
  background-color: #0056b3;
}

#scale-toggle-btn {
  padding: 8px 16px;
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
}

#scale-toggle-btn:hover {
  background-color: #218838;
}

.table {
  font-size: 0.8em;
  white-space: nowrap;
}

.table th, .table td {
  padding: 0.3rem 0.2rem;
  text-align: center;
  vertical-align: top;
  font-size: 0.75em;
  min-width: 60px;
}

.table th {
  font-size: 0.7em;
  background-color: #f8f9fa;
  font-weight: bold;
  line-height: 1.1;
  word-wrap: break-word;
  hyphens: auto;
}

#subject-table {
  overflow-x: auto;
  max-width: 100%;
  margin: 1rem 0;
}

#pk-table {
  width: 100%;
  min-width: 1200px;
  table-layout: auto;
  border-collapse: collapse;
}

#pk-table th {
  white-space: normal;
  word-break: break-word;
  max-width: 80px;
}

#pk-table td {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Quiz styles */
.quiz-section {
  background-color: #fff;
  border: 2px solid #17a2b8;
  border-radius: 8px;
  padding: 15px;
  margin-top: 20px;
}

.quiz-question {
  margin-bottom: 15px;
  padding: 10px;
  background-color: #f8f9fa;
  border-radius: 5px;
}

.quiz-feedback {
  display: block;
  margin-top: 5px;
  font-size: 0.85em;
  font-weight: bold;
}

.quiz-feedback.correct {
  color: #28a745;
}

.quiz-feedback.incorrect {
  color: #dc3545;
}

.drug-name-section {
  background-color: #fff;
  border: 2px solid #007bff;
  border-radius: 8px;
  padding: 20px;
  margin-top: 20px;
}

</style>